<?xml version="1.0" encoding="UTF-8" ?>
<Module>
  <!-- Last updated 12/6/2006 -->
  <ModulePrefs title="Random Flickr" title_url="http://www.therandomhomepage.com"
			   height="350"
               author="Siddique Hameed"
               description="Flip through or view slideshow of random images from Flickr with amazing visual effects. Click on the image to view lightbox effect."
               author_email="siddii+randomhomepage@gmail.com"
               render_inline="optional"
               scrolling="false"
               thumbnail="http://www.therandomhomepage.com/google/gadget/images/thumbnail.png"
               screenshot="http://www.therandomhomepage.com/google/gadget/images/screenshot.png"
          >
  </ModulePrefs>
  <UserPref name="tags" display_name="Tags (comma separated values)" required="true" datatype="string" default_value="colorful"/>
  <UserPref name="transition_effect" display_name="Transition effect" datatype="enum" default_value="0">
   <EnumValue display_value="None"  value="-1" />
   <EnumValue display_value="Random"  value="0" />
   <EnumValue display_value="Blindown "  value="1" />
   <EnumValue display_value="Blindup "  value="2" />
   <EnumValue display_value="Highlight"  value="3" />
   <EnumValue display_value="Dropout"  value="4" />
   <EnumValue display_value="Shake"  value="5" />
   <EnumValue display_value="Pulsate"  value="6" />
   <EnumValue display_value="Squish"  value="7" />
   <EnumValue display_value="Fold"  value="8" />
   <EnumValue display_value="Grow"  value="9" />
   <EnumValue display_value="Shrink"  value="10" />
   <EnumValue display_value="Puff"  value="11" />
   <EnumValue display_value="Slidedown"  value="12" />
   <EnumValue display_value="Slideup"  value="13" />
   <EnumValue display_value="Fade"  value="14" />
   </UserPref>
  <UserPref name="slideshow_delay" display_name="Slideshow delay" datatype="enum" default_value="0">
   <EnumValue display_value="No slideshow"  value="0" />
   <EnumValue value="5" />
   <EnumValue value="10" />
   <EnumValue value="15" />
   <EnumValue value="20" />
   <EnumValue value="25" />
   <EnumValue value="30" />
   <EnumValue value="35" />
   <EnumValue value="40" />
   <EnumValue value="45" />
   <EnumValue value="50" />
   <EnumValue value="55" />
   <EnumValue value="60" />
</UserPref>

<Content type="html-inline">
  <![CDATA[
	<script type="text/javascript" src="http://www.therandomhomepage.com/js/prototype.js"></script>
	<script type="text/javascript" src="http://www.therandomhomepage.com/js/effects.js"></script>
	<script type="text/javascript" src="http://www.therandomhomepage.com/js/lightbox_s.js"></script>
	<link rel="stylesheet" href="http://www.therandomhomepage.com/css/lightbox.css" type="text/css" media="screen" />
	<style type="text/css">
		img {
			border-style: none;
			cursor: pointer;
		}

		.arrow {
			width:5%;
			cursor: pointer;
			color: darkblue;
			font-weight: bold;
			text-align: right;
		}

		.header {
			width:95%;
			color: black;
			font-weight: bold;
			text-align: center;
		}
		.contentClass {
			text-align: center;
		}
	</style>
	<script type="text/javascript">

	var prefs = new _IG_Prefs(__MODULE_ID__);

	var rssFeedArr = new Array();

	var RssFeed = Class.create();

	RssFeed.prototype = {

	   initialize: function(idx,title,link,desc,contentURL,thumbnailURL) {
			this.idx = idx;
			this.title = title;
			this.link = link;
			this.desc = desc;
			this.contentURL = contentURL;
			this.thumbnailURL = thumbnailURL;
	   },

	   getImage:function() {
		  return "<a id='lightboxAnc"+this.idx+"' startslideshow='true' forever='true' slideDuration='5' rel='lightbox[colorful]' href='"+this.contentURL+"'>"+extractBetween(this.desc,"<img",">")+"</a>";
	   },

	   getTitle:function() {
		  return this.title;
	   }

	};

	function getRandomNo(upperBound){
	  return Math.floor(Math.random() * upperBound);
	}

	function xmlResponseHandler(response) {
		var items = response.getElementsByTagName("item");
		var nodes = $A(items);
		var i = 0;
		nodes.each(function(itemNode){
				var title = getChildNodeValueByNodeName(itemNode,"title");
				var link = getChildNodeValueByNodeName(itemNode,"link");
				var desc = getChildNodeValueByNodeName(itemNode,"description");
				var content = getChildNodeByNodeName(itemNode,"media:content").getAttribute("url");
				var thumbnail = getChildNodeByNodeName(itemNode,"media:thumbnail").getAttribute("url");
				rssFeedArr[i++] = new RssFeed(i,title,link,desc,content,thumbnail);
	    });

		if (nodes.length > 0)
		{

			var html = "";
			rssFeedArr.each( function(rssFeed){
				html += rssFeed.getImage();
			});

			_gel("content__MODULE_ID__").innerHTML = html;
			initLightbox();


			var randIdx = getRandomNo(nodes.length);
			var anchorElement = _gel("lightboxAnc"+randIdx);
			if (anchorElement)
			{
				alert("anchorElement.innerHTML = "+anchorElement.innerHTML);
				Element.visible(anchorElement);
			}
			_gel("header__MODULE_ID__").innerHTML = rssFeedArr[randIdx].getTitle();
		}
	}

	function getChildNodeValueByNodeName(node,nodeNameStr){
		var nodeList = node.childNodes;
		 for (var j = 0; j < nodeList.length ; j++) {
			var node = nodeList.item(j);
			if (node.nodeName == nodeNameStr && node.firstChild)
			{
				return node.firstChild.nodeValue;
			}
		 }
	}

	function getChildNodeByNodeName(node,nodeNameStr){
		var nodeList = node.childNodes;
		 for (var j = 0; j < nodeList.length ; j++) {
			var node = nodeList.item(j);
			if (node.nodeName == nodeNameStr)
			{
				return node;
			}
		 }
	}


	function extractBetween(str,startsWith,endsWith) {
		var startIdx =  str.indexOf(startsWith);
		if (startIdx != -1)
		{
			var endIdx = str.indexOf(endsWith,startIdx);
			if (endIdx != -1)
			{
				return str.substring(startIdx,endIdx+1);
			}
		}
		return "";
	}

	function randomFlickrLoad(){
		var flickrFeedURL = "http://www.flickr.com/services/feeds/photos_public.gne?tags="+prefs.getString("tags")+"&format=rss_200";
		_IG_FetchXmlContent(flickrFeedURL,xmlResponseHandler);
	}

    //_IG_RegisterOnloadHandler(initLightbox);

    </script>
    <div id="content83" class="contentClass"><a id="lightboxAnc1" startslideshow="true" forever="true" slideduration="5" rel="lightbox[colorful]" href="http://static.flickr.com/143/317726966_f60131f33c_o.jpg"><img src="http://static.flickr.com/143/317726966_f60131f33c_m.jpg" alt="26 mars 2006" style="border: 1px solid rgb(221, 221, 221);" height="160" width="240"></a><a id="lightboxAnc2" startslideshow="true" forever="true" slideduration="5" rel="lightbox[colorful]" href="http://static.flickr.com/123/317720642_c852505f0f_m.jpg"><img src="http://static.flickr.com/123/317720642_c852505f0f_m.jpg" alt="Sombrero Galaxy" style="border: 1px solid rgb(221, 221, 221);" height="180" width="240"></a><a id="lightboxAnc4" startslideshow="true" forever="true" slideduration="5" rel="lightbox[colorful]" href="http://static.flickr.com/127/317692885_3ffe70b256_m.jpg"><img src="http://static.flickr.com/127/317692885_3ffe70b256_m.jpg" alt="World Trade Center Reflections" style="border: 1px solid rgb(221, 221, 221);" height="180" width="240"></a>
        <a id="lightboxAnc6" startslideshow="true" forever="true" slideduration="5" rel="lightbox[colorful]" href="http://static.flickr.com/120/317032772_000bcf69ab_o.jpg"><img src="http://static.flickr.com/120/317032772_000bcf69ab_m.jpg" alt="Butterfly" style="border: 1px solid rgb(221, 221, 221);" height="180" width="240"></a><a id="lightboxAnc7" startslideshow="true" forever="true" slideduration="5" rel="lightbox[colorful]" href="http://static.flickr.com/124/317662547_467aae99b8_o.jpg"><img src="http://static.flickr.com/124/317662547_467aae99b8_m.jpg" alt="Magic colors" style="border: 1px solid rgb(221, 221, 221);" height="240" width="160"></a><a id="lightboxAnc8" startslideshow="true" forever="true" slideduration="5" rel="lightbox[colorful]" href="http://static.flickr.com/127/317662286_bc0e894d0c_o.jpg"><img src="http://static.flickr.com/127/317662286_bc0e894d0c_m.jpg" alt="Yellow, orange, red, pink, ..." style="border: 1px solid rgb(221, 221, 221);" height="160" width="240"></a><a id="lightboxAnc9" startslideshow="true" forever="true" slideduration="5" rel="lightbox[colorful]" href="http://static.flickr.com/132/317655079_65754598e3_o.jpg"><img src="http://static.flickr.com/132/317655079_65754598e3_m.jpg" alt="imminent" style="border: 1px solid rgb(221, 221, 221);" height="184" width="240"></a>
        <a id="lightboxAnc11" startslideshow="true" forever="true" slideduration="5" rel="lightbox[colorful]" href="http://static.flickr.com/141/317636239_a936c55a9d_o.jpg"><img src="http://static.flickr.com/141/317636239_a936c55a9d_m.jpg" alt="Florida Bracelet" style="border: 1px solid rgb(221, 221, 221);" height="180" width="240"></a><a id="lightboxAnc12" startslideshow="true" forever="true" slideduration="5" rel="lightbox[colorful]" href="http://static.flickr.com/135/317619195_05861db7a5_m.jpg"><img src="http://static.flickr.com/135/317619195_05861db7a5_m.jpg" alt="" style="border: 1px solid rgb(221, 221, 221);" height="240" width="180"></a><a id="lightboxAnc13" startslideshow="true" forever="true" slideduration="5" rel="lightbox[colorful]" href="http://static.flickr.com/124/317607471_32337d999c_o.jpg"><img src="http://static.flickr.com/124/317607471_32337d999c_m.jpg" alt="Fancy Gift Box" style="border: 1px solid rgb(221, 221, 221);" height="240" width="224"></a><a id="lightboxAnc14" startslideshow="true" forever="true" slideduration="5" rel="lightbox[colorful]" href="http://static.flickr.com/126/317601894_2b56b28e19_m.jpg"><img src="http://static.flickr.com/126/317601894_2b56b28e19_m.jpg" alt="DJ's Diner" style="border: 1px solid rgb(221, 221, 221);" height="160" width="240"></a><a id="lightboxAnc15" startslideshow="true" forever="true" slideduration="5" rel="lightbox[colorful]" href="http://static.flickr.com/132/317571305_1b01fa7441_o.png"><img src="http://static.flickr.com/132/317571305_1b01fa7441_m.jpg" alt="5ptz Interior Court2" style="border: 1px solid rgb(221, 221, 221);" height="65" width="240"></a><a id="lightboxAnc16" startslideshow="true" forever="true" slideduration="5" rel="lightbox[colorful]" href="http://static.flickr.com/130/317569036_37a3fcd2eb_o.jpg"><img src="http://static.flickr.com/130/317569036_37a3fcd2eb_m.jpg" alt="Friday night traffic" style="border: 1px solid rgb(221, 221, 221);" height="160" width="240"></a><a id="lightboxAnc17" startslideshow="true" forever="true" slideduration="5" rel="lightbox[colorful]" href="http://static.flickr.com/139/317568986_6c993f01c1_o.jpg"><img src="http://static.flickr.com/139/317568986_6c993f01c1_m.jpg" alt="Friday night traffic" style="border: 1px solid rgb(221, 221, 221);" height="160" width="240"></a><a id="lightboxAnc18" startslideshow="true" forever="true" slideduration="5" rel="lightbox[colorful]" href="http://static.flickr.com/140/317568933_040d82db0f_o.jpg"><img src="http://static.flickr.com/140/317568933_040d82db0f_m.jpg" alt="Friday night traffic" style="border: 1px solid rgb(221, 221, 221);" height="160" width="240"></a><a id="lightboxAnc19" startslideshow="true" forever="true" slideduration="5" rel="lightbox[colorful]" href="http://static.flickr.com/128/317568892_3cee1927ed_o.jpg"><img src="http://static.flickr.com/128/317568892_3cee1927ed_m.jpg" alt="Friday night traffic" style="border: 1px solid rgb(221, 221, 221);" height="160" width="240"></a><a id="lightboxAnc20" startslideshow="true" forever="true" slideduration="5" rel="lightbox[colorful]" href="http://static.flickr.com/123/317568864_b974e2c563_o.jpg"><img src="http://static.flickr.com/123/317568864_b974e2c563_m.jpg" alt="Friday night traffic" style="border: 1px solid rgb(221, 221, 221);" height="240" width="160"></a></div>
  ]]>
  </Content>

</Module>