<?xml version="1.0" encoding="ISO-8859-1"?>
<project name="TheRandomHomepage-Java" default="backupWebsite" basedir=".">

    <property file="${user.home}/user.properties"/>
    <property name="build.dir" value="./build"/>
    <property name="backup.dir" value="${build.dir}/backups"/>
    <property name="lib.dir" value="../../lib"/>

    <tstamp>
        <format property="build.time" pattern="MMMM-dd-yyyy-HH-mm"/>
    </tstamp>

    <target name="init">
        <mkdir dir="${build.dir}"/>
        <mkdir dir="${backup.dir}"/>
    </target>

    <target name="clean">
        <delete dir="${backup.dir}"/>
        <delete dir="${build.dir}"/>
    </target>

    <target name="deployRandomFlickrGadget" description="FTP">
        <ftp server="${ftp_host}"
             remotedir="dev/gadgets/RandomFlickr"
             userid="${user_id}"
             password="${password}"
             depends="yes"
             verbose="yes"
                >
            <fileset dir="out/therandomhomepage.RandomFlickr"/>
        </ftp>
    </target>

    <target name="deployLightbox" description="FTP">
        <ftp server="${ftp_host}"
             remotedir="dev/google/gadgets/RandomFlickr"
             userid="${user_id}"
             password="${password}"
             depends="yes"
             verbose="yes"
                >
            <fileset dir="C:\downloads\lightbox2.02"/>
        </ftp>
    </target>


    <target name="backupWebsite" depends="clean,init">
        <echo>Backing up ${ftp_host}...</echo>
        <ftp action="get"
             server="${ftp_host}"
             userid="${user_id}"
             password="${password}">
            <fileset dir="${backup.dir}">
                <include name="**/*"/>
                <exclude name="**/cache/**"/>
                <exclude name="**/_vti_cnf/**"/>
                <exclude name="**/stats/**"/>
            </fileset>
        </ftp>
        <jar destfile="${build.dir}/${ftp_host}-${build.time}.jar"
             basedir="${backup.dir}"
             includes="**"
                />
        <mail
                mailhost="${backup_mail_host}"
                mailport="${backup_mail_port}"
                from="${backup_mail_user}"
                tolist="${backup_mail_user}"
                user="${backup_mail_user}"
                password="${backup_mail_password}"
                ssl="on"
                encoding="mime"
                subject="Backup for ${ftp_host} since ${build.time}"
                message="Backup for ${ftp_host} since ${build.time}"
                files="${build.dir}/${build.time}.jar"/>
        <delete file="${build.dir}/${build.time}.jar"/>
    </target>

</project>