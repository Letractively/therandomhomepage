<?xml version="1.0" encoding="ISO-8859-1"?>
<project name="TheRandomHomepage-Java" default="backupWebsite" basedir=".">

    <property file="${user.home}/user.properties"/>
    <property name="widgets.source.dir" value="widgets/Lightbox Image/java"/>
    <property name="lib.dir" value="lib"/>

    <property name="build.dir" value="./build"/>
    <property name="backup.dir" value="${build.dir}/backups"/>
    <property name="widgets.output.dir" value="${build.dir}/widgets"/>


    <path id="project.classpath">
		<pathelement location="${widgets.source.dir}" />
		<fileset dir="${lib.dir}">
			<include name="**/*.jar" />
		</fileset>
	</path>


    <defaultexcludes echo="true" add="**/out/**"/>
    <defaultexcludes echo="true" add="**/tomcat/**"/>
    <defaultexcludes echo="true" add="**/.gwt-cache/**"/>
    <defaultexcludes add="**/.svn"/>
    <defaultexcludes add="**/.svn/**"/>
    <defaultexcludes add="**/_svn"/>
    <defaultexcludes add="**/_svn/**"/>

    <patternset id="compiler.resources">
      <include name="**/?*.properties"/>
      <include name="**/?*.xml"/>
      <include name="**/?*.gif"/>
      <include name="**/?*.png"/>
      <include name="**/?*.jpeg"/>
      <include name="**/?*.jpg"/>
      <include name="**/?*.html"/>
      <include name="**/?*.htm"/>
      <include name="**/?*.dtd"/>
      <include name="**/?*.tld"/>
      <include name="**/?*.js"/>
      <include name="**/?*.css"/>
    </patternset>

    <tstamp>
        <format property="build.time" pattern="MMMM-dd-yyyy-HH-mm"/>
    </tstamp>

    <target name="init">
        <mkdir dir="${build.dir}"/>
        <mkdir dir="${backup.dir}"/>
        <mkdir dir="${widgets.output.dir}"/>
    </target>

    <target name="clean">
        <delete dir="${backup.dir}"/>
        <delete dir="${build.dir}"/>
    </target>

    <target name="backupWebsite" depends="clean,init">
        <echo>Backing up ${ftp_host}...</echo>
        <ftp action="get"
             server="${ftp_host}"
             userid="${user_id}"
             password="${password}">
            <fileset dir="${backup.dir}">
                <include name="**/*"/>
                <exclude name="**/cache/**"/>
                <exclude name="**/_vti_cnf/**"/>
                <exclude name="**/stats/**"/>
            </fileset>
        </ftp>
        <jar destfile="${build.dir}/${ftp_host}-${build.time}.jar"
             basedir="${backup.dir}"
             includes="**"
                />
        <mail
                mailhost="${backup_mail_host}"
                mailport="${backup_mail_port}"
                from="${backup_mail_user}"
                tolist="${backup_mail_user}"
                user="${backup_mail_user}"
                password="${backup_mail_password}"
                ssl="on"
                encoding="mime"
                subject="Backup for ${ftp_host} since ${build.time}"
                message="Backup for ${ftp_host} since ${build.time}"
                files="${build.dir}/${build.time}.jar"/>
        <delete file="${build.dir}/${build.time}.jar"/>
    </target>

    <target name="backupUserProperties" depends="clean,init">
        <copyfile src="${user.home}/user.properties" dest="${backup.dir}/user.properties"/>
        <echo>Backing up user.properties...</echo>
        <mail
                mailhost="${backup_mail_host}"
                mailport="${backup_mail_port}"
                from="${backup_mail_user}"
                tolist="${backup_mail_user}"
                user="${backup_mail_user}"
                password="${backup_mail_password}"
                ssl="on"
                encoding="mime"
                subject="Backup of user properties"
                message="Backup of user properties"
                files="user.properties"/>
    </target>

    <target name="buildWidgetsLibrary" depends="clean,init">
        <echo>Building widget library from source path ${widgets.source.dir}</echo>
        <javac srcdir="${widgets.source.dir}" destdir="${widgets.output.dir}" target="1.4" debug="on" debuglevel="lines,vars,source" classpathref="project.classpath">
            <!--<include name="${widgets.source.dir}/therandomhomepage/widgets/client/*.java"/>-->
            <classpath refid="project.classpath"/>
        </javac>
        <!--<copy todir="${widgets.output.dir}">-->
          <!--<fileset dir="${widgets.source.dir}">-->
            <!--<patternset refid="compiler.resources"/>-->
            <!--<include name="**/?*.java"/>-->
            <!--<type type="file"/>-->
          <!--</fileset>-->
        <!--</copy>-->
    </target>


</project>