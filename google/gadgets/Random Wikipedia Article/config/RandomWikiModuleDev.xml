<?xml version="1.0" encoding="UTF-8" ?>
<Module>
    <ModulePrefs title="__UP_moduletitle__" directory_title="Random Wikipedia Article"
                 title_url="http://www.TheRandomHomepage.com" description="Flip through random articles from Wikipedia in your favorite language.Currently supported in English, Deutsch, Español, Français, Italiano, Nederlands, 日本語, Polski, Português, Русский and Svenska."
                 author="Siddique Hameed" author_email="siddii+randomhomepage@gmail.com" height="350" scrolling="true"
                 thumbnail="http://www.therandomhomepage.com/google/gadgets/randomwiki/thumbnail.png"
                 screenshot="http://www.therandomhomepage.com/google/gadgets/randomwiki/screenshot.png">
        <Locale lang="de"/>
        <Locale lang="en"/>
        <Locale lang="es"/>
        <Locale lang="fr"/>
        <Locale lang="it"/>
        <Locale lang="nl"/>
        <Locale lang="ja"/>
        <Locale lang="pl"/>
        <Locale lang="pt"/>
        <Locale lang="ru"/>
        <Locale lang="sv"/>
    </ModulePrefs>
    <UserPref name="moduletitle" display_name="Title" default_value="Random Wikipedia Article" required="true"/>
    <UserPref name="language" display_name="Language" default_value="en" datatype="enum">
        <EnumValue value="de" display_value="Deutsch"/>
        <EnumValue value="en" display_value="English"/>
        <EnumValue value="es" display_value="Español"/>
        <EnumValue value="fr" display_value="Français"/>
        <EnumValue value="it" display_value="Italiano"/>
        <EnumValue value="nl" display_value="Nederlands"/>
        <EnumValue value="ja" display_value="日本語"/>
        <EnumValue value="pl" display_value="Polski"/>
        <EnumValue value="pt" display_value="Português"/>
        <EnumValue value="ru" display_value="Русский"/>
        <EnumValue value="sv" display_value="Svenska"/>
    </UserPref>
	<!-- Last Updated : 11/20/2006 -->
    <Content type="html"><![CDATA[
<style type="text/css">
a {
    text-decoration: none;
    color: #002bb8;
    background: none;
}
a:visited { color: #5a3696; }
a:active { color: Orange; }
a:hover { text-decoration: underline; }
a.stub { color: #772233; }
img {
    border: none;
    vertical-align: middle;
}
p {
    margin: 0.4em 0em 0.5em 0em;
    line-height: 1.5em;
}
p img { margin: 0; }
hr {
    height: 1px;
    color: #aaaaaa;
    background-color: #aaaaaa;
    border: 0;
    margin: 0.2em 0 0.2em 0;
}
h1, h2, h3, h4, h5, h6 {
    color: Black;
    background: none;
    font-weight: normal;
    margin: 0;
    padding-top: 0.5em;
    padding-bottom: 0.17em;
}
div.contentClass {
	background-color:#F4F4F4;
	border:solid 1px #aaaaaa;padding:8px;
}
</style>
 <table width="100%"><tr><td width="95%" align="left"><div id="header__MODULE_ID__"></div></td><td width="5%" align="right" valign="top"><div id="arrow__MODULE_ID__" class="arrow"></div></td></table>
 <div id="content__MODULE_ID__" class="contentClass"><center><I>Loading article from Wikipedia...</I></center></div>
 <script type="text/javascript">

	var arrRandomWikipediaURL = new Array();
	arrRandomWikipediaURL["en"] = "http://en.wikipedia.org/wiki/Special:Random";
	arrRandomWikipediaURL["fr"] = "http://fr.wikipedia.org/wiki/Special:Random";
	arrRandomWikipediaURL["ja"] = "http://ja.wikipedia.org/wiki/%E7%89%B9%E5%88%A5:Random";
	arrRandomWikipediaURL["it"] = "http://it.wikipedia.org/wiki/Speciale:Random";
	arrRandomWikipediaURL["sv"] = "http://sv.wikipedia.org/wiki/Special:Random";
	arrRandomWikipediaURL["es"] = "http://es.wikipedia.org/wiki/Especial:Random";
	arrRandomWikipediaURL["pt"] = "http://pt.wikipedia.org/wiki/Especial:Random";
	arrRandomWikipediaURL["nl"] = "http://nl.wikipedia.org/wiki/Speciaal:Random";
	arrRandomWikipediaURL["pl"] = "http://pl.wikipedia.org/wiki/Specjalna:Random";
	arrRandomWikipediaURL["de"] = "http://de.wikipedia.org/wiki/Spezial:Random";
	arrRandomWikipediaURL["ru"] = "http://ru.wikipedia.org/wiki/%D0%A1%D0%BB%D1%83%D0%B6%D0%B5%D0%B1%D0%BD%D0%B0%D1%8F:Random";

	var prefs = new _IG_Prefs(__MODULE_ID__);
	var lang = null;

    function getRandomWiki__MODULE_ID__() {
        lang = prefs.getString("language");
        var randomWikipediaURL = arrRandomWikipediaURL[lang];
        var url = randomWikipediaURL+"?rnd="+Math.random();
        _IG_FetchContent( url, fetchContentFromWikipedia);
		setHTML("content__MODULE_ID__","<center><I>Loading article from Wikipedia...</I></center>");
		setHTML("header__MODULE_ID__","&nbsp;");
	}

	function fetchContentFromWikipedia(responseText) {
         var actualURL = grep(responseText,'Retrieved from "<a href="','">http://');
         var title = grep(responseText,'<h1 class="firstHeading">','</h1>');
         setHTML("header__MODULE_ID__","<a title='"+title+"' target='_new' href='"+actualURL+"'><h3>"+title+"</h3></a>");
         setHTML("arrow__MODULE_ID__","<div title='Next Random Article' style='font-family: Arial, sans-serif;font-weight:bold;color:darkblue;cursor:pointer;' onClick='getRandomWiki__MODULE_ID__()'>&gt;&gt;&nbsp;&nbsp;</div>");

         var bodyContent = grep(responseText,'<div id="bodyContent">','<div class="printfooter">');
         var actualBodyContent = grep(bodyContent,'<p>','Saved in parser cache');
         var replaceTargetRegex = 'target="_blank" href="http://'+lang+'.wikipedia.org';
         actualBodyContent = actualBodyContent.replace(/href=\"/g, replaceTargetRegex);

         var replaceLinkRegexSearch = '/http:\/\/'+lang+'.wikipedia.orghttp/g';
         actualBodyContent = actualBodyContent.replace(replaceLinkRegexSearch, 'http');
         actualBodyContent += " There was some error reading content from Wikipedia! <br/>Please try again later...-->";
		 setHTML("content__MODULE_ID__",actualBodyContent);
	}


// Function grep() starts here
function grep(wholeStr, startsWith, endsWith)
{
	var grepStr = "";
	var iFrom = wholeStr.indexOf(startsWith);
	var iTo = wholeStr.indexOf(endsWith); 
	iFrom += startsWith.length;
	if (iTo > iFrom) {
		grepStr = wholeStr.substring(iFrom, iTo);
	}
	return grepStr;
}
// Function grep() ends here

// Function setHTML() starts here
function setHTML(id, str)
{
	var element = _gel(id);
	if (element) {
		element.innerHTML = str;
	}
}
// Function setHTML() starts here

 _IG_RegisterOnloadHandler(getRandomWiki__MODULE_ID__);
 </script>
 <script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-941159-1";
urchinTracker();
</script>
 ]]>
    </Content>
</Module>