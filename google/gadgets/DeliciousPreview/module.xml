<?xml version="1.0" encoding="UTF-8" ?>
<Module>
    <ModulePrefs title="Delicious Preview"
                 title_url="http://www.BoxySystems.com" description="Preview what everyone is bookmarking in del.icio.us using this gadget."
                 author="Siddique Hameed" author_email="siddii+randomhomepage@gmail.com" height="350" scrolling="true"
                 thumbnail="http://www.therandomhomepage.com/google/gadgets/DeliciousPreview/deliciousthumbnail.png"
                 screenshot="http://www.therandomhomepage.com/google/gadgets/DeliciousPreview/deliciousscreenshot.gif"
                 author_affiliation="http://www.BoxySystems.com"
                 author_location = "Ann Arbor, MI"
                 author_photo = "http://www.therandomhomepage.com/images/author.jpg"
                 author_aboutme = "I am an aspiring entrepreneur who likes crafting software both for living and hobbies. Still searching for the perfect click of my life..."
                 author_link = "http://blogs.boxysystems.com"
                 author_quote = "World Wide Web is a sea of HTML, you never know what you gonna catch!"
            >
	<!--
		Last Updated : 11/21/2007
		Initial version
	-->
    <Require feature="analytics"/>
	<Require feature="tabs"/>
	<Require feature="setprefs"/>
    </ModulePrefs>
	<UserPref name="Hotlist" default_value="http://del.icio.us/rss/" datatype="hidden" />
	<UserPref name="Popular" default_value="http://del.icio.us/rss/popular" datatype="hidden" />
	<UserPref name="Recent" default_value="http://del.icio.us/rss/recent" datatype="hidden" />
	<UserPref name="selectedTab" datatype="hidden" />
    <Content type="html">
<![CDATA[
<style type="text/css">
		img {
			border-style: none;
			cursor: pointer;
		}

		div.title {
			font-weight: bold;
			font-size:90%;
		}

		a.titleLink {
			color: #000000;
			text-decoration: none;
		}

		a.titleLink:hover {
			text-decoration: underline;
		}

		div.feedItem {
			font-size:90%;
			margin-bottom: 5px;
		}

		div.feedItemMouseOver {
			background-color:#EDF4FC;
		}

		div.feedItemMouseOut {
			background-color:#FFFFFF;
		}

		ul {
			font-size:90%;
		}

		li {
			font-size:90%;
		}

</style>
<!--<script type="text/javascript" src="http://www.therandomhomepage.com/js/prototype.js"></script>-->
<script type="text/javascript" src="http://www.therandomhomepage.com/js/utils.js"></script>

 <script type="text/javascript">
	var prefs = new _IG_Prefs(__MODULE_ID__);
	var tabs = new _IG_Tabs(__MODULE_ID__);

	var websnaprURLPrefix = "http://images.websnapr.com/?key=zLcr3AbYt202&url=";


	function loadModule__MODULE_ID__(){
		_IG_Analytics("UA-941159-1", "/DeliciousPreviewGoogleGadget");

		tabs.addDynamicTab("Hotlist", loadTabsCallbackGenerator(prefs.getString("Hotlist")));
		tabs.addDynamicTab("Popular", loadTabsCallbackGenerator(prefs.getString("Popular")));
		tabs.addDynamicTab("Recent", loadTabsCallbackGenerator(prefs.getString("Recent")));
	}

	function feedItemMouseOver(feedItem){
		feedItem.className = "feedItemMouseOver";
	}

	function feedItemMouseOut(feedItem){
		feedItem.className = "feedItemMouseOut";
	}

	function loadTabsCallbackGenerator(feedUrl) {
		return function(tabId) {
			loadTab(tabId, feedUrl);
		}
	}



   function loadTab(tabId,feedUrl) {
	   var container = _gel(tabId);
	  _IG_FetchFeedAsJSON(
		feedUrl,
		function(feed) {
			showFeeds(container, tabId, feed)
		},
		10,
		true);
	}

	function showFeedsCallbackGenerator(feedUrl,tabId) {
		return function(feed) {
		  showFeeds(feed, feedUrl,tabId);
		}
	}


	function showFeeds(container, tabId, feed){

		 if (feed == null){
				 container.innerHTML = "Error reading content from http://del.icio.us";
                 return;
         }

		if (feed.Entry) {
			var linksHTML = '';
             for (var i = 0; i < feed.Entry.length; i++) {

				linksHTML += '<div class="feedItem" onmouseover="feedItemMouseOver(this);" onmouseout="feedItemMouseOut(this);"><table><tr><td colspan="2"><div class="title"><a class="titleLink" target="_new" href="'+feed.Entry[i].Link+'">'+feed.Entry[i].Title+'</a></div></td></tr>';

				var tagDiv = document.createElement("div");
				tagDiv.innerHTML = feed.Entry[i].Summary;

				var tagLinks = tagDiv.getElementsByTagName("a");
				var ol = '';
				for(var j=0; j < tagLinks.length; j++) {
					if (tagLinks[j].rel == "tag")
					{
						if (ol == '')
						{
							ol += "<ul><b>Tags: </b>";
						}
						ol += "<li>"+tagLinks[j].innerHTML+"</li>";
					}
				}

				if (ol != '')
				{
					ol += "</ul>";
				}

				linksHTML += '<tr><td valign="top"><a target="_new" href="'+feed.Entry[i].Link+'"><img src="'+websnaprURLPrefix + feed.Entry[i].Link+'" /"></a></td><td valign="top">'+ol+'</td></tr></table></div>';

             }
			container.innerHTML = linksHTML;
        }
	}

 _IG_RegisterOnloadHandler(loadModule__MODULE_ID__);
 </script>
 ]]>
    </Content>
</Module>